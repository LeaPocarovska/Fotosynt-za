<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f0f7f4;
            margin: 0;
            padding: 0;
        }

        header {
            background: #2f855a;
            color: white;
            padding: 1rem 2rem;
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        main {
            max-width: 900px;
            margin: 1.5rem auto;
            padding: 0 1rem 2rem;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
        }

        .card h2 {
            margin-top: 0;
            font-size: 1.3rem;
        }

        .setup-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
        }

        label {
            font-weight: 600;
            margin-right: 0.25rem;
        }

        input[type="number"],
        input[type="text"] {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            border: 1px solid #cbd5e0;
        }

        button {
            padding: 0.4rem 0.9rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            background: #2b6cb0;
            color: white;
            transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.2s ease;
        }

        button:hover {
            background: #2c5282;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .actions button {
            margin: 0.25rem 0.25rem 0.25rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
        }

        th, td {
            border-bottom: 1px solid #e2e8f0;
            padding: 0.35rem 0.4rem;
            text-align: center;
            font-size: 0.9rem;
        }

        th {
            background: #edf2f7;
        }

        #log {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9rem;
            padding-left: 1.1rem;
        }

        #log li {
            margin-bottom: 0.15rem;
        }

        .badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            background: #edf2f7;
            color: #2d3748;
            margin-left: 0.5rem;
        }

        .info-text {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .winner {
            font-weight: 700;
            color: #2f855a;
        }

        .flex-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .flex-col {
            flex: 1 1 260px;
        }

        .event-box {
            margin: 0.7rem 0 0.8rem;
            padding: 0.6rem 0.8rem;
            border-radius: 8px;
            border: 1px dashed #cbd5e0;
            background: #f7fafc;
        }

        .event-name {
            font-weight: 700;
            margin: 0 0 0.2rem;
        }

        .event-positive {
            border-color: #9ae6b4;
            background: #f0fff4;
        }

        .event-negative {
            border-color: #feb2b2;
            background: #fff5f5;
        }

        .event-neutral {
            border-color: #cbd5e0;
            background: #f7fafc;
        }

        #plantEmoji {
            font-size: 2.4rem;
            display: inline-block;
            margin-top: 0.2rem;
        }
    </style>
</head>
<body>
<header>
    <h1>Lovec foton≈Ø ‚Äì interaktivn√≠ simulace</h1>
</header>
<main>
    <!-- Nastaven√≠ hry -->
    <section class="card">
        <h2>Nastaven√≠ hry</h2>
        <div class="setup-row">
            <div>
                <label for="playerName">Jm√©no hr√°ƒçe:</label>
                <input type="text" id="playerName" placeholder="nap≈ô. Anna" />
            </div>
            <div>
                <label for="maxRounds">Poƒçet kol:</label>
                <input type="number" id="maxRounds" min="3" max="30" value="10">
            </div>
            <button id="startGameBtn">Spustit hru</button>
        </div>
        <p class="info-text">
            Hraje≈° za <strong>jednu rostlinu</strong>. Na zaƒç√°tku ka≈æd√©ho kola z√≠sk√°≈°:
            <br>‚Ä¢ svƒõtlo = poƒçet list≈Ø üåø
            <br>‚Ä¢ voda = poƒçet ko≈ôen≈Ø üå±
            <br>‚Ä¢ CO‚ÇÇ = 1 üå´Ô∏è
            <br>Nav√≠c se v ka≈æd√©m kole stane <strong>n√°hodn√° ud√°lost prost≈ôed√≠</strong> (slunce, d√©≈°≈•, sucho...),
            kter√° m≈Ø≈æe pomoci nebo u≈°kodit. V ka≈æd√©m kole sm√≠≈° prov√©st <strong>jednu akci</strong>.
            Na konci hry se seƒçte tvoje gluk√≥za, listy a ko≈ôeny. Vyhr√°v√° ten z cel√© skupiny, kdo m√° nejvƒõt≈°√≠ sk√≥re.
        </p>
    </section>

    <!-- Hra -->
    <section class="card" id="gameSection" style="display:none;">
        <div class="flex-row">
            <div class="flex-col">
                <h2>Tv≈Øj tah</h2>
                <p class="info-text">
                    <strong>Hr√°ƒç:</strong> <span id="playerNameDisplay"></span>
                    <span class="badge">Kolo: <span id="roundDisplay">1</span></span>
                </p>

                <div id="eventBox" class="event-box event-neutral">
                    <p id="eventName" class="event-name">Ud√°lost tohoto kola</p>
                    <p id="eventDescription" class="event-desc info-text">
                        Zat√≠m ≈æ√°dn√° ud√°lost.
                    </p>
                </div>

                <p class="info-text">
                    Na zaƒç√°tku <strong>ka≈æd√©ho kola</strong> automaticky z√≠sk√°≈° zdroje podle sv√© rostliny
                    a podle aktu√°ln√≠ ud√°losti prost≈ôed√≠. Potom si vyber <strong>jednu akci</strong>:
                </p>

                <h3>Akce v tomto kole</h3>
                <div class="actions">
                    <button class="action-btn" data-action="photosynthesis">Fotosynt√©za</button>
                    <button class="action-btn" data-action="growLeaf">R≈Øst listu</button>
                    <button class="action-btn" data-action="growRoot">R≈Øst ko≈ôene</button>
                </div>

                <p class="info-text" style="margin-top:0.5rem;">
                    <strong>N√°klady / efekty:</strong><br>
                    ‚Ä¢ Fotosynt√©za: ‚àí1 svƒõtlo, ‚àí1 voda, ‚àí1 CO‚ÇÇ ‚Üí +1 gluk√≥za
                      <br>&nbsp;&nbsp;(+ mal√° ≈°ance na ‚Äûkritickou‚Äú fotosynt√©zu = +2 gluk√≥zy)<br>
                    ‚Ä¢ R≈Øst listu: ‚àí1 gluk√≥za ‚Üí +1 list (v√≠ce svƒõtla do budoucna)<br>
                    ‚Ä¢ R≈Øst ko≈ôene: ‚àí1 gluk√≥za ‚Üí +1 ko≈ôen (v√≠ce vody do budoucna)
                </p>

                <button id="nextRoundBtn" style="margin-top:0.8rem;">Dal≈°√≠ kolo</button>
                <p class="info-text" style="margin-top:0.3rem;">
                    Nejd≈ô√≠v si vyber akci, potom klikni na ‚ÄûDal≈°√≠ kolo‚Äú.
                </p>
            </div>

            <div class="flex-col">
                <h2>Stav rostliny</h2>
                <p class="info-text">
                    Tvoje rostlina: <span id="plantEmoji">üå±</span>
                </p>
                <table>
                    <thead>
                    <tr>
                        <th>Listy üåø</th>
                        <th>Ko≈ôeny üå±</th>
                        <th>Svƒõtlo ‚òÄÔ∏è</th>
                        <th>Voda üíß</th>
                        <th>CO‚ÇÇ üå´Ô∏è</th>
                        <th>Gluk√≥za üç¨</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td id="statLeaves">0</td>
                        <td id="statRoots">0</td>
                        <td id="statLight">0</td>
                        <td id="statWater">0</td>
                        <td id="statCo2">0</td>
                        <td id="statGlucose">0</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Log -->
    <section class="card" id="logSection" style="display:none;">
        <h2>Pr≈Øbƒõh hry</h2>
        <ul id="log"></ul>
    </section>

    <!-- V√Ωsledek -->
    <section class="card" id="winnerSection" style="display:none;">
        <h2>V√Ωsledek hry</h2>
        <p id="winnerText"></p>
        <p class="info-text">
            Zapi≈° si sv√© jm√©no a poƒçet gluk√≥zy üç¨. Porovn√°n√≠m v√Ωsledk≈Ø v≈°ech √∫ƒçastn√≠k≈Ø zjist√≠te v√≠tƒõze.
        </p>
    </section>
</main>

<script>
"use strict";

// --- Hern√≠ stav ---
let player = null;
let round = 1;
let maxRounds = 10;
let gameStarted = false;
let hasActedThisRound = false;
let currentEvent = null;

// --- Definice n√°hodn√Ωch ud√°lost√≠ prost≈ôed√≠ ---
const EVENTS = [
    {
        id: "sunny",
        name: "Sluneƒçn√Ω den ‚òÄÔ∏è",
        description: "Extra slunce! Z√≠sk√°≈° +1 svƒõtla nav√≠c.",
        mood: "positive",
        applyGains(gains, player) {
            gains.light += 1;
        }
    },
    {
        id: "cloudy",
        name: "Zata≈æeno ‚òÅÔ∏è",
        description: "M√°lo slunce. Z√≠sk√°≈° o 1 svƒõtla m√©nƒõ (ale ne m√©nƒõ ne≈æ 0).",
        mood: "negative",
        applyGains(gains, player) {
            gains.light -= 1;
        }
    },
    {
        id: "rain",
        name: "Vydatn√Ω d√©≈°≈• üåßÔ∏è",
        description: "Ko≈ôeny se naplnily vodou ‚Äì z√≠sk√°≈° +1 vody nav√≠c.",
        mood: "positive",
        applyGains(gains, player) {
            gains.water += 1;
        }
    },
    {
        id: "drought",
        name: "Sucho üî•",
        description: "Sucho omezuje vodu. Pokud m√°≈° m√©nƒõ ne≈æ 3 ko≈ôeny, p≈ôijde≈° o 1 vodu zisku.",
        mood: "negative",
        applyGains(gains, player) {
            if (player.roots < 3) {
                gains.water -= 1;
            }
        }
    },
    {
        id: "cleanAir",
        name: "ƒåist√Ω vzduch üåç",
        description: "Mnoho CO‚ÇÇ v atmosf√©≈ôe ‚Äì z√≠sk√°≈° +1 CO‚ÇÇ nav√≠c.",
        mood: "positive",
        applyGains(gains, player) {
            gains.co2 += 1;
        }
    },
    {
        id: "pollution",
        name: "Zneƒçi≈°tƒõn√≠ vzduchu üè≠",
        description: "Zneƒçi≈°tƒõn√≠ sni≈æuje √∫ƒçinn√Ω CO‚ÇÇ ‚Äì z√≠sk√°≈° o 1 CO‚ÇÇ m√©nƒõ.",
        mood: "negative",
        applyGains(gains, player) {
            gains.co2 -= 1;
        }
    },
    {
        id: "herbivores",
        name: "≈Ωrav√Ω hmyz üêõ",
        description: "Hmyz ti o≈æral listy ‚Äì pokud nƒõjak√© m√°≈°, p≈ôijde≈° o 1 list.",
        mood: "negative",
        applyGains(gains, player) {
            if (player.leaves > 0) {
                player.leaves -= 1;
            }
        }
    },
    {
        id: "pollinators",
        name: "Piln√≠ opylovaƒçi üêù",
        description: "Ekosyst√©m ti p≈ôeje ‚Äì zdarma z√≠sk√°≈° +1 gluk√≥zu.",
        mood: "positive",
        applyGains(gains, player) {
            player.glucose += 1;
        }
    }
];

// --- Pomocn√© funkce DOM ---
function $(selector) {
    return document.querySelector(selector);
}

function logMessage(text) {
    const logList = $("#log");
    const li = document.createElement("li");
    const timestamp = new Date().toLocaleTimeString("cs-CZ", { hour12: false });
    li.textContent = "[" + timestamp + "] " + text;
    logList.appendChild(li);
    logList.scrollTop = logList.scrollHeight;
}

// --- Rostlinn√Ω ‚Äûavatar‚Äú podle √∫spƒõ≈°nosti ---
function getPlantEmoji(player) {
    const score = player.leaves + player.roots + player.glucose;
    if (score < 4) return "üå±";
    if (score < 8) return "üåø";
    return "üå≥";
}

// --- N√°hodn√° ud√°lost pro kolo ---
function pickRandomEvent() {
    const index = Math.floor(Math.random() * EVENTS.length);
    return EVENTS[index];
}

function updateEventUI() {
    const box = $("#eventBox");
    const nameEl = $("#eventName");
    const descEl = $("#eventDescription");

    box.classList.remove("event-positive", "event-negative", "event-neutral");

    if (!currentEvent) {
        nameEl.textContent = "≈Ω√°dn√° ud√°lost";
        descEl.textContent = "Zat√≠m se nic nedƒõje.";
        box.classList.add("event-neutral");
        return;
    }

    nameEl.textContent = currentEvent.name;
    descEl.textContent = currentEvent.description;

    if (currentEvent.mood === "positive") {
        box.classList.add("event-positive");
    } else if (currentEvent.mood === "negative") {
        box.classList.add("event-negative");
    } else {
        box.classList.add("event-neutral");
    }
}

// --- Zah√°jen√≠ hry ---
function startGame() {
    const nameInput = $("#playerName");
    const roundsInput = $("#maxRounds");
    const name = nameInput.value.trim() || "Nezn√°m√Ω hr√°ƒç";
    const roundsValue = parseInt(roundsInput.value, 10);

    if (isNaN(roundsValue) || roundsValue < 3 || roundsValue > 30) {
        alert("Zadej poƒçet kol mezi 3 a 20.");
        return;
    }

    maxRounds = roundsValue;
    round = 1;
    hasActedThisRound = false;

    player = {
        name: name,
        leaves: 1,
        roots: 1,
        light: 0,
        water: 0,
        co2: 0,
        glucose: 0
    };

    gameStarted = true;

    $("#playerNameDisplay").textContent = player.name;
    $("#roundDisplay").textContent = String(round);

    $("#gameSection").style.display = "block";
    $("#logSection").style.display = "block";
    $("#winnerSection").style.display = "none";
    $("#log").innerHTML = "";

    $("#startGameBtn").disabled = true;

    logMessage("Hra spu≈°tƒõna pro hr√°ƒçe " + player.name + " na " + maxRounds + " kol.");
    giveStartOfRoundResources();
    render();
}

 function giveStartOfRoundResources() {
    let gains = {
        light: player.leaves,
        water: player.roots,
        co2: 1
    };

    if (round === 1) {
        currentEvent = null;
        logMessage("Prvn√≠ kolo: ≈æ√°dn√° n√°hodn√° ud√°lost.");
    } else {
        currentEvent = pickRandomEvent();
        logMessage("Ud√°lost kola: " + currentEvent.name + ".");
        currentEvent.applyGains(gains, player);
    }

    gains.light = Math.max(0, gains.light);
    gains.water = Math.max(0, gains.water);
    gains.co2 = Math.max(0, gains.co2);

    player.light += gains.light;
    player.water += gains.water;
    player.co2 += gains.co2;

    logMessage(
        "Kolo " + round + ": " + player.name +
        " z√≠sk√°v√° " + gains.light + " svƒõtla, " +
        gains.water + " vody a " +
        gains.co2 + " CO‚ÇÇ" +
        (round === 1 ? " (bez speci√°ln√≠ ud√°losti)." : " (po vlivu ud√°losti).")
    );

    updateEventUI();
}


// --- Vykreslen√≠ stavu ---
function render() {
    $("#statLeaves").textContent = String(player.leaves);
    $("#statRoots").textContent = String(player.roots);
    $("#statLight").textContent = String(player.light);
    $("#statWater").textContent = String(player.water);
    $("#statCo2").textContent = String(player.co2);
    $("#statGlucose").textContent = String(player.glucose);

    $("#roundDisplay").textContent = String(round);
    $("#plantEmoji").textContent = getPlantEmoji(player);

    // Ovl√°d√°n√≠ tlaƒç√≠tek
    const actionButtons = document.querySelectorAll(".action-btn");
    actionButtons.forEach(btn => {
        btn.disabled = !gameStarted || hasActedThisRound;
    });

    $("#nextRoundBtn").disabled = !gameStarted || !hasActedThisRound;
}

// --- Akce hr√°ƒçe ---
function performAction(action) {
    if (!gameStarted) return;
    if (hasActedThisRound) {
        alert("V tomto kole u≈æ jsi akci provedl/a. Pokraƒçuj na ‚ÄûDal≈°√≠ kolo‚Äú.");
        return;
    }

    switch (action) {
        case "photosynthesis":
            if (player.light >= 1 && player.water >= 1 && player.co2 >= 1) {
                player.light -= 1;
                player.water -= 1;
                player.co2 -= 1;
                player.glucose += 1;

                // ≈°ance na ‚Äûkritickou‚Äú fotosynt√©zu ‚Äì extra gluk√≥za
                const critChance = 0.18; // 18 %
                if (Math.random() < critChance) {
                    player.glucose += 1;
                    logMessage(player.name + " prov√°d√≠ KRITICKOU fotosynt√©zu a z√≠sk√°v√° 2 gluk√≥zy!");
                } else {
                    logMessage(player.name + " prov√°d√≠ fotosynt√©zu a z√≠sk√°v√° 1 gluk√≥zu.");
                }
            } else {
                alert("Nedostatek zdroj≈Ø na fotosynt√©zu (pot≈ôebuje≈° 1 svƒõtlo, 1 vodu a 1 CO‚ÇÇ).");
                return;
            }
            break;

        case "growLeaf":
            if (player.glucose >= 1) {
                player.glucose -= 1;
                player.leaves += 1;
                logMessage(player.name + " investuje 1 gluk√≥zu do r≈Østu listu (+1 list).");
            } else {
                alert("Nedostatek gluk√≥zy na r≈Øst listu (pot≈ôebuje≈° 1).");
                return;
            }
            break;

        case "growRoot":
            if (player.glucose >= 1) {
                player.glucose -= 1;
                player.roots += 1;
                logMessage(player.name + " investuje 1 gluk√≥zu do r≈Østu ko≈ôene (+1 ko≈ôen).");
            } else {
                alert("Nedostatek gluk√≥zy na r≈Øst ko≈ôene (pot≈ôebuje≈° 1).");
                return;
            }
            break;

        default:
            console.warn("Nezn√°m√° akce:", action);
            return;
    }

    hasActedThisRound = true;
    render();
}

// --- Dal≈°√≠ kolo ---
function nextRound() {
    if (!gameStarted) return;
    if (!hasActedThisRound) {
        alert("Nejd≈ô√≠ve v tomto kole proveƒè jednu akci.");
        return;
    }

    round++;

    if (round > maxRounds) {
        endGame();
        return;
    }

    hasActedThisRound = false;
    giveStartOfRoundResources();
    render();
}

// --- Konec hry ---
function endGame() {
    gameStarted = false;

    $("#startGameBtn").disabled = false;
    $("#winnerSection").style.display = "block";

    // V√Ωsledek = listy + ko≈ôeny + gluk√≥za
    const score = player.leaves + player.roots + player.glucose;

    const text = player.name +
        " konƒç√≠ hru se sk√≥re " + score +
        " (listy: " + player.leaves +
        ", ko≈ôeny: " + player.roots +
        ", gluk√≥za: " + player.glucose + ").";

    $("#winnerText").innerHTML = '<span class="winner">' + text + '</span>';
    logMessage("Hra konƒç√≠. " + text);

    // Zak√°zat dal≈°√≠ akce
    const actionButtons = document.querySelectorAll(".action-btn");
    actionButtons.forEach(btn => btn.disabled = true);
    $("#nextRoundBtn").disabled = true;
}


// --- Event listenery ---
document.addEventListener("DOMContentLoaded", () => {
    $("#startGameBtn").addEventListener("click", startGame);

    const actionButtons = document.querySelectorAll(".action-btn");
    actionButtons.forEach(btn => {
        btn.addEventListener("click", (event) => {
            const action = event.currentTarget.getAttribute("data-action");
            performAction(action);
        });
    });

    $("#nextRoundBtn").addEventListener("click", nextRound);
});
</script>
</body>
</html>
